---
title: AndroidStudioDebug技巧
date: 2016-10-12 09:10:05
tags: 
- Debug
- Android
categories: 
- 移动开发
---

# 几种不同的断点

## 调试基础
一般来说有两种办法调试一个debuggable的apk；其一是下断点，然后用debug模式编译安装这个app；其二是 attach process，在Android Studio里面就是一个对话框

## Evaluate Expression
这个功能非常实用，可以在断点处直接进入一个求值环境，在这里你可以执行任何你感兴趣的表达式；

## 条件断点
假设你的断点在一个列表的循环里面，可是你只对这个列表的某一个元素感兴趣，只想在遇到这个元素的时候才断下来；你是一直点F9 直到满足条件吗？条件断点就是满足这种需求的，顾名思义，在特定条件下的断点。使用起来也非常简单，在你的断点上鼠标右键会出现一个小窗口，写上条件即可。
<!--more-->
## 日志断点
很多时候我们调试的时候更多的是打印日志定位异常代码，缩小范围之后再使用断点解决问题；所以经常做的事情就是在代码里面添加日志信息，输出函数参数，返回信息，输出我们感兴趣的变量信息等。

但是这么做一个问题就是，我们添加了日志代码需要重新编译；在没有 Instant Run 之前是非常痛苦的，每次编译少则几十秒，多则几分钟；这样无意义的等待简直就是折磨；其实，除了热部署工具，我们还可以使用日志断点解决这个问题。

首先我们在想要输出信息的地方下一个断点；然后右键这个断点，在出现的设置框里面把这个断点的 suspend 属性设置为 False ，这样虽然叫做“断点”，但是并不会真正断下来；然后，我们在 log message 里面填上我们想要输出的日志信息。如下图(注意标红位置）：

## 方法断点
传统的调试方式是以行为单位的，所谓单步调试；但是很多时候我们关心的是某个函数的参数，返回值；（回想一下我们使用日志的时候打印的最多的信息难道不是函数的参数和返回值吗？）使用方法断点，我们可以在函数级别进行调试；如果经常跳进跳出函数或者只对某个函数的参数感兴趣，这种类型的断点非常实用。具体使用方法有两种方式；最简单的是在你感兴趣的方法头那一行打上断点，这时候你会发现断点图标有点不一样，这就是方法断点了

## 异常断点
在有些情况下，我们只对某些特定的异常感兴趣，或者我们只对异常感兴趣；我们希望只要程序发生异常程序就能断下来；这好像保存现场一样，只要发生命案了（异常），第一时间保存现场，这样什么指纹之类的线索就会清晰很多，坏蛋就算想逃也是插翅难飞啊。

Android Studio给了我们这个能力！那就是异常断点!可以在特定异常发生的时候，直接让整个程序断下来；如果你对所有异常感兴趣，直接 Throwable 即可。


## Field WatchPoint
在上面我们添加异常断点的时候，点击加号的时候，有四个选项；第一个就是我们前面所说的第二种方法断点的添加方式，第三个是异常断点，那么第二个 Field WatchPoint 是干什么的呢？

有没有这样一种场景：你发现某个值莫名其妙滴不知道什么时候被谁给修改了，罪魁祸首是谁？Java虽然是值传递，但是引用也可以是值；对象全部存放在堆上面，而堆是被所有线程共享的，因此在非常复杂的场景下，你根本不知道这些共享变量被谁修改了，这样非常危险；在多线程环境下，不变性是一个很重要的特性，我们看到高并发的语言诸如 Erlang, Scala 对于这种不变性都有着某种程度的支持。